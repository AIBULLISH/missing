<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Find My Cat - $MISSING</title>
<style>
  body { margin:0; overflow:hidden; background:black; touch-action: none; }
  canvas { display:block; }
  #arms {
    position: fixed;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 150px;
    opacity: 0.8;
    pointer-events: none;
    z-index: 10;
  }
  #hint {
    position: fixed;
    bottom: 10px;
    width: 100%;
    text-align: center;
    color: #aaa;
    font-family: monospace;
    font-size: 14px;
    z-index: 5;
  }
  /* Mobile joystick */
  #joystick {
    position: fixed;
    bottom: 20px;
    left: 20px;
    width: 80px;
    height: 80px;
    background: rgba(255,255,255,0.1);
    border-radius: 50%;
    touch-action: none;
  }
</style>
</head>
<body>

<img src="arms.png" id="arms" alt="Player Arms">
<div id="hint">Still searching...</div>
<div id="joystick"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.155/build/three.min.js"></script>
<script>

// ---------- THREE.JS Setup ----------
const scene = new THREE.Scene();
scene.fog = new THREE.Fog(0x000000, 5, 50);

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.y = 1.6;

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const light = new THREE.HemisphereLight(0xffffff, 0x222222, 0.8);
scene.add(light);

// ---------- Simple Labyrinth ----------
const wallMaterial = new THREE.MeshStandardMaterial({ color: 0x222222 });

function createWall(x, z, w=5, h=3, d=1) {
  const wall = new THREE.Mesh(new THREE.BoxGeometry(w,h,d), wallMaterial);
  wall.position.set(x, h/2, z);
  scene.add(wall);
}

// Generate random walls
for (let i=0; i<60; i++){
  createWall(Math.floor(Math.random()*60-30), Math.floor(Math.random()*60-30));
}

// ---------- Player Movement ----------
let moveForward=false, moveBackward=false, moveLeft=false, moveRight=false;
let pointerDown=false;
let prevTouchX=0, prevTouchY=0;
let rotSpeed=0.002;
let moveSpeed=0.2;

document.addEventListener('keydown', e => {
  if(e.key==='w') moveForward=true;
  if(e.key==='s') moveBackward=true;
  if(e.key==='a') moveLeft=true;
  if(e.key==='d') moveRight=true;
});
document.addEventListener('keyup', e => {
  if(e.key==='w') moveForward=false;
  if(e.key==='s') moveBackward=false;
  if(e.key==='a') moveLeft=false;
  if(e.key==='d') moveRight=false;
});

// Mouse-look (desktop)
document.addEventListener('mousemove', e=>{
  if(document.pointerLockElement){
    camera.rotation.y -= e.movementX * rotSpeed;
    camera.rotation.x -= e.movementY * rotSpeed;
    camera.rotation.x = Math.max(-Math.PI/2, Math.min(Math.PI/2, camera.rotation.x));
  }
});
document.body.addEventListener('click', ()=>{document.body.requestPointerLock();});

// ---------- Mobile Touch ----------
const joystick = document.getElementById('joystick');
let joystickTouchId=null;
let joystickStartX=0, joystickStartY=0;
let joyMoveX=0, joyMoveY=0;

joystick.addEventListener('touchstart', e=>{
  joystickTouchId = e.changedTouches[0].identifier;
  joystickStartX = e.changedTouches[0].clientX;
  joystickStartY = e.changedTouches[0].clientY;
});
joystick.addEventListener('touchmove', e=>{
  for(let t of e.changedTouches){
    if(t.identifier===joystickTouchId){
      joyMoveX = t.clientX - joystickStartX;
      joyMoveY = t.clientY - joystickStartY;
    }
  }
});
joystick.addEventListener('touchend', e=>{
  for(let t of e.changedTouches){
    if(t.identifier===joystickTouchId){
      joystickTouchId=null;
      joyMoveX=0; joyMoveY=0;
    }
  }
});

// ---------- Cat Sounds ----------
const miaus = ['miau1.mp3','miau2.mp3','miau3.mp3']; // Dateien bereitstellen
function playRandomMiau(){
  const audio = new Audio(miaus[Math.floor(Math.random()*miaus.length)]);
  audio.volume = 0.3;
  audio.play();
}
setInterval(()=>{ if(Math.random()<0.02) playRandomMiau(); }, 1000);

// ---------- Animate ----------
const arms = document.getElementById('arms');
let walkCycle = 0;
const walkSpeed = 0.05;

function animate(){
  requestAnimationFrame(animate);
  
  // Desktop movement
  let dirX=0, dirZ=0;
  if(moveForward) dirZ -= moveSpeed;
  if(moveBackward) dirZ += moveSpeed;
  if(moveLeft) dirX -= moveSpeed;
  if(moveRight) dirX += moveSpeed;
  
  // Mobile joystick
  if(joyMoveX || joyMoveY){
    dirX += joyMoveX * 0.01;
    dirZ += joyMoveY * 0.01;
  }

  const sinY = Math.sin(camera.rotation.y);
  const cosY = Math.cos(camera.rotation.y);
  camera.position.x += dirX * cosY - dirZ * sinY;
  camera.position.z += dirZ * cosY + dirX * sinY;

  // Arms wackeln beim Laufen
  if(moveForward || moveBackward || moveLeft || moveRight || joyMoveX || joyMoveY){
    walkCycle += walkSpeed;
    arms.style.transform = `translateX(-50%) rotate(${Math.sin(walkCycle)*5}deg)`;
  } else {
    arms.style.transform = `translateX(-50%) rotate(0deg)`;
  }

  renderer.render(scene,camera);
}
animate();

// Resize
window.addEventListener('resize', ()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
